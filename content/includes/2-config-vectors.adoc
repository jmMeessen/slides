[{invert}]
= Jenkins configuration vectors

{nbsp} +

//https://images.app.goo.gl/2FJcGwDAmixKy7Wk7
[.stretch]
image::outillage.jpg[]

= Direct file System manipulation


= Command Line Interfaces
* two types
** REST API
** Jenkins CLI


= REST API

* using HTTP requests to GET, PUT, POST and DELETE data.

[source,bash]
----
curl -X POST "<jekinsURL>/testProject/build" --user jmm:<password|token>
----


= REST API => use a token

[.notes]
--
* one way algo (owner is responssible to protect it)
* Bonus -> how to retrieve programatically a token
--

= Jenkins CLI

= Jenkins CLI - Classic

{nbsp} +

Much better ðŸ˜ƒ :
[source,bash]
----
java -jar jenkins-cli.jar -http -s $JENKINS_URL -auth @FILE command ...
----

{nbsp} +

Can use file permission, easy to configure with Ansible

= Jenkins CLI - SSH

{nbsp} +

[source,bash]
----
ssh -l jmm -i ~/.ssh/id_rsa -p 10200 my-jenkins-server help
----

{nbsp} +

ðŸ¤” Can solve some of the bootstrapping problem


= Summary

[%step]
* Rich set of API
* Easy to use in Ansible for example
* CLI does a better job at controlling parameter
* CLI makes synchonous calls
* CLI commands are better documented ðŸ˜‡
* Parsing results is tricky ðŸ˜’

= Recommendation

[%step]
* Use CLI 
* Use CLI with SSH if you can (networking)
* Consider executing commands from target host (localhost).

= Groovy Scripts

image::Groovy-logo.png[height=400]

[%step]
// * Richest way to configure Jenkins
// * Need developer skills ðŸ¤“
// * Documentation not easy to find
* Make them idempotent ! ðŸ‘€

= How to use Groovy Script

[%step]
* via the script console
* at startup, as init-script
** placed in `$JENKINS_HOME/init.groovy.d/`
// ** executed in lexical order
* via the CLI

= Groovy Scripts from the CLI

{nbsp} +

[source,bash]
----
cat my_script.groovy | {{ CLI_command }} groovy =
----

= Docker Container

{nbsp} +

image::Docker-whale.png[height=400]

= Jenkins Configuration as Code

image::JCasC.jpeg[height=350]

//{nbsp} +

* Declarative method, yaml based
* Loaded on reboot or with a CLI command

= JCasC Example (LDAP cfg)

[source,yaml]
----
jenkins:
  securityRealm:
    ldap:
      configurations:
      - inhibitInferRootDN: false
        managerDN: "uid=idm,ou=Administrators,dc=example,dc=com"
        managerPasswordSecret: "{{ ldap_admin_passw }}"
        rootDN: "dc=example,dc=com"
        server: "ldap://{{ full_agent_docker_dns_name }}:389"
      disableMailAddressResolver: false
      disableRolePrefixing: true
      groupIdStrategy: "caseInsensitive"
      userIdStrategy: "caseInsensitive"
----

= JCasC Example (JNLP agent)

[source,yaml]
----
jenkins:
  nodes:
  - permanent:
      labelString: "jnlp"
      mode: NORMAL
      name: "jnlp-agent"
      remoteFS: "/home/jenkins"
      launcher:
        jnlp:
          workDirSettings:
            disabled: true
      nodeDescription: "Agent that initiates its own connection to Jenkins"
      retentionStrategy: "always"
  numExecutors: 0

----

= Current Status
[%step]
* In technical preview for CloudBees products
[%step]
// ** Masters configuration already works
// ** CloudBees functionality actively been worked on
** Waiting for RBAC support ðŸ˜›
* Centralized CasC management from CJOC

